{{#if (gt data.activeSubscriptions.totalEntries 0)}}
<div id="subscriptions-container">
    {{#with data.activeSubscriptions as |list|}}
    <div class="card-header border-0 flex-column align-items-start">
        {{#if (gt list.totalEntries 1)}}
        <h3 class="card-title">Active Beneficiaries ({{list.totalEntries}})</h3>
        <div class="text-secondary">
            Below orphans/ beneficiaries have been linked to your profile.
            Click on a photo to see beneficiary details.
            We are trying to build a live reporting system that makes us all, our donors/ employees/ sponsor
            organizations/ beneficiaries, work hands in hands.
            Please reach out to us for your valuable feedback on whatsapp (Qasim Ali +47 92 91 6580 | Hamid Farooq +47
            4015 0015 | Abdul Wahab +47 4578 2299).
        </div>
        {{else}}
        <h3 class="card-title">Active Beneficiary</h3>
        <div class="text-secondary">
            Below orphan/ beneficiary has been linked to your profile.
            Click on a photo to see beneficiary details.
            We are trying to build a live reporting system that makes us all, our donors/ employees/ sponsor
            organizations/ beneficiaries, work hands in hands.
            Please reach out to us for your valuable feedback on whatsapp (Qasim Ali +47 92 91 6580 | Hamid Farooq +47
            4015 0015 | Abdul Wahab +47 4578 2299).
        </div>
        {{/if}}
    </div>

    {{#if (gt list.totalPages 1)}}
    <div class="card-header border-top d-flex align-items-center">
        <p class="m-0 text-secondary">Page <span>{{list.currentPage}}</span> of <span>{{list.totalPages}}</span></p>
        <ul class="pagination m-0 ms-auto">
            <li class="page-item {{#if (eq list.hasPrevPage false)}}disabled{{/if}}">
                <a class="page-link cursor-pointer" tabindex="-1" aria-disabled="true"
                    my-href="/get-active-subscriptions/{{../data.customer._id}}?page={{dec list.currentPage}}"
                    onclick="getActiveSubscriptions(this)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M15 6l-6 6l6 6"></path>
                    </svg>
                </a>
            </li>
            {{#each list.pagesArray}}
            <li class="page-item {{#if (eq list.currentPage this)}}active{{/if}}">
                <a class="page-link cursor-pointer" my-href="/get-active-subscriptions/{{../../data.customer._id}}?page={{this}}"
                    onclick="getActiveSubscriptions(this)">{{this}}</a>
            </li>
            {{/each}}
            <li class="page-item {{#if (eq list.hasNextPage false)}}disabled{{/if}}">
                <a class="page-link cursor-pointer" tabindex="-1" aria-disabled="true"
                    my-href="/get-active-subscriptions/{{../data.customer._id}}?page={{inc list.currentPage}}"
                    onclick="getActiveSubscriptions(this)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="icon">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M9 6l6 6l-6 6"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </div>
    {{/if}}

    <div class="p-3 {{#if (eq list.totalEntries 1)}}pt-0{{/if}}">
        {{#each list.subscriptions}}
        <div project-slug="{{this.project.slug}}" class="fs-5 text-uppercase mb-4 badge">{{this.project.name}}</div>
        <div class="row">
            {{#each this.entries as |ben|}}
            <a data-bs-toggle="popover" data-bs-placement="top" data-bs-trigger="hover focus" title="{{ben.entry.name}}"
                {{#if ben.expiry}} data-bs-html="true"
                data-bs-content="Paid one-time in Order-{{ben.orderNo}} on {{formatDate ben.createdAt}}. <br> Order expires on <span class='text-red'>{{formatDate ben.expiry}}</span>."
                {{else}} data-bs-html="true"
                data-bs-content="Monthly subscribed in Order-{{ben.orderNo}} on {{formatDate ben.createdAt}}. <br> Subscription renews on <span class='text-red'>{{formatDate ben.renewalDate}}</span>."
                {{/if}} class="cursor-pointer col-md-3 col-6 mb-3 text-center position-relative"
                href="/entry/{{ben.entry._id}}/project/{{../this.project.slug}}">
                <span class="position-absolute top-0 left-0 ti ti-check" style="padding-top: 3px"></span>
                <img class="img-fluid rounded-circle border border-1" alt="{{ben.entry.name}}"
                    src="{{circleCloudinaryUrl (or ben.entry.photo (or ben.entry.photoOfChild ben.entry.photoOfOrphan))}}">
            </a>
            {{/each}}
        </div>
        {{/each}}
    </div>
    {{/with}}
</div>
{{/if}}

{{#if data.previousSponsorships}}
{{#if (gt data.previousSponsorships.length 0)}}
<div id="previous-sponsorships-container" class="mt-4">
    <div class="card-header border-0 flex-column align-items-start">
        {{#if (gt data.previousSponsorships.length 1)}}
        <h3 class="card-title">Previous Sponsorships ({{data.previousSponsorships.length}})</h3>
        <div class="text-secondary">
            Below are the orphans/beneficiaries you have previously sponsored, including both ended sponsorships and expired orders. 
            Thank you for your past contributions to their lives. These sponsorships have ended, but you can see the impact you made during your sponsorship period.
        </div>
        {{else}}
        <h3 class="card-title">Previous Sponsorship</h3>
        <div class="text-secondary">
            Below is the orphan/beneficiary you have previously sponsored. Thank you for your past contribution to their life.
            This sponsorship has ended, but you can see the impact you made during your sponsorship period.
        </div>
        {{/if}}
    </div>

    <div class="p-3">
        {{#each data.previousSponsorships as |sponsorship|}}
        {{#if sponsorship.project}}
        <div class="mb-4">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <div project-slug="{{sponsorship.project.slug}}" class="fs-5 text-uppercase badge badge-outline text-muted">
                    {{sponsorship.project.name}}
                </div>
                <div class="small text-muted">
                    {{#if (eq sponsorship.source 'expired_order')}}
                        <i class="ti ti-clock-x me-1"></i>Expired Order
                        {{#if sponsorship.orderNo}}#{{sponsorship.orderNo}}{{/if}}
                    {{else}}
                        <i class="ti ti-clock-pause me-1"></i>Ended Sponsorship
                    {{/if}}
                </div>
            </div>
            
            {{#if sponsorship.entry}}
            <div class="row">
                <div class="col-md-4 col-sm-6 col-12 mb-3">
                    <div class="card h-100" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                        <div class="card-body text-center p-3">
                            <div class="position-relative d-inline-block mb-3">
                                <a href="/entry/{{sponsorship.entry._id}}/project/{{sponsorship.project.slug}}" class="text-decoration-none">
                                    <img class="rounded-circle border border-2" 
                                         style="width: 80px; height: 80px; object-fit: cover; filter: grayscale(20%); opacity: 0.9;"
                                         alt="{{sponsorship.entry.name}}" 
                                         src="{{circleCloudinaryUrl (or sponsorship.entry.photo (or sponsorship.entry.photoOfChild sponsorship.entry.photoOfOrphan))}}">
                                </a>
                                <span class="position-absolute top-0 end-0 badge bg-secondary rounded-pill" style="font-size: 0.7em;">
                                    {{#if (eq sponsorship.source 'expired_order')}}
                                        <i class="ti ti-clock-x"></i>
                                    {{else}}
                                        <i class="ti ti-clock-pause"></i>
                                    {{/if}}
                                </span>
                            </div>
                            
                            <h6 class="card-title mb-2 text-dark">{{sponsorship.entry.name}}</h6>
                            
                            <div class="row text-center g-2 mb-3">
                                <div class="col-6">
                                    <div class="small text-muted">Duration</div>
                                    <div class="fw-semibold">{{sponsorship.durationInMonths}} months</div>
                                </div>
                                <div class="col-6">
                                    <div class="small text-muted">Total Paid</div>
                                    <div class="fw-semibold text-success">{{sponsorship.formattedTotalPaid}}</div>
                                </div>
                            </div>

                            <div class="border-top pt-2">
                                <div class="small text-muted mb-1">
                                    <i class="ti ti-calendar-check me-1"></i>
                                    Started: {{formatDate sponsorship.startedAt}}
                                </div>
                                <div class="small text-muted mb-1">
                                    <i class="ti ti-calendar-x me-1"></i>
                                    Ended: {{formatDate sponsorship.stoppedAt}}
                                </div>
                                {{#if sponsorship.reasonStopped}}
                                <div class="small text-muted">
                                    <i class="ti ti-info-circle me-1"></i>
                                    {{sponsorship.reasonStopped}}
                                </div>
                                {{/if}}
                            </div>
                        </div>
                        <div class="card-footer bg-transparent border-top-0 pt-0 pb-3">
                            <a href="/entry/{{sponsorship.entry._id}}/project/{{sponsorship.project.slug}}" 
                               class="btn btn-sm btn-outline-primary w-100">
                                <i class="ti ti-eye me-1"></i>View Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {{else}}
            <div class="alert alert-info">
                <i class="ti ti-info-circle me-2"></i>
                <div>
                    <strong>Beneficiary information not available</strong>
                    <div class="small mt-1">
                        {{#if (eq sponsorship.source 'expired_order')}}
                            Order {{#if sponsorship.orderNo}}#{{sponsorship.orderNo}}{{/if}} expired on {{formatDate sponsorship.stoppedAt}}
                        {{else}}
                            Sponsorship ended on {{formatDate sponsorship.stoppedAt}}
                        {{/if}}
                        {{#if sponsorship.formattedTotalPaid}} • Total paid: {{sponsorship.formattedTotalPaid}}{{/if}}
                    </div>
                </div>
            </div>
            {{/if}}
        </div>
        {{else}}
        <div class="mb-4">
            <div class="alert alert-warning">
                <i class="ti ti-exclamation-triangle me-2"></i>
                <div>
                    <strong>Project information not available</strong>
                    <div class="small mt-1">
                        {{#if (eq sponsorship.source 'expired_order')}}
                            Order {{#if sponsorship.orderNo}}#{{sponsorship.orderNo}}{{/if}} expired on {{formatDate sponsorship.stoppedAt}}
                        {{else}}
                            Sponsorship ended on {{formatDate sponsorship.stoppedAt}}
                        {{/if}}
                        {{#if sponsorship.formattedTotalPaid}} • Total paid: {{sponsorship.formattedTotalPaid}}{{/if}}
                    </div>
                </div>
            </div>
        </div>
        {{/if}}
        {{/each}}
    </div>
</div>
{{/if}}
{{/if}}